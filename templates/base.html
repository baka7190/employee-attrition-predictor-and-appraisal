<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Employee Attrition & Appraisal System{% endblock %}</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  {% block head_extra %}{% endblock %}

  <style>
  :root{
    --brand:#2563eb; --brand-2:#0ea5e9;
    --navy-900:#0b1220; --navy-800:#101a2e;
    --surface:#ffffff; --page-top:#f7f9fc; --page-bottom:#f3f6fb;
    --ink:#0f172a; --muted:#6b7280; --line:#e6eaf2;
    --shadow-lg:0 14px 38px rgba(2,6,23,.14);
    --shadow-md:0 10px 24px rgba(2,6,23,.10); --radius:14px;
  }
  html,body{height:100%}
  body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
       color:var(--ink); background:linear-gradient(180deg, var(--page-top), var(--page-bottom)); background-attachment: fixed;}

  /* HEADER */
  .utilbar{background:#0e1526;color:rgba(255,255,255,.8);font-size:.85rem;position:sticky;top:0;z-index:1031;border-bottom:1px solid rgba(255,255,255,.06);}
  .utilbar .container-xxl{display:flex;align-items:center;justify-content:space-between;padding:.35rem 0;}
  .status-dot{width:.55rem;height:.55rem;border-radius:50%;background:#22c55e;display:inline-block;margin-right:.35rem;}
  .util-links a{color:rgba(255,255,255,.85);margin-right:14px;text-decoration:none;}
  .util-links a:hover{color:#fff;}

  .appbar{background:linear-gradient(180deg,rgba(11,18,32,.92),rgba(16,26,46,.88));backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);
          color:#fff;position:sticky;top:26px;z-index:1030;border-bottom:1px solid rgba(255,255,255,.06);transition:box-shadow .25s ease;}
  .appbar.elevated{box-shadow:0 10px 30px rgba(2,6,23,.35);}
  .navbar-brand{display:flex;align-items:center;gap:.6rem;}
  .brand-logo{height:28px;}
  .brand-text{font-weight:600;letter-spacing:.2px;}
  .nav-search{min-width:260px;}
  @media(max-width:991.98px){.nav-search{min-width:100%;}}
  .nav-search .form-control{background:rgba(255,255,255,.12);color:#fff;border-color:rgba(255,255,255,.18);}
  .nav-search .form-control::placeholder{color:rgba(255,255,255,.65);}
  .avatar{width:34px;height:34px;border-radius:50%;background:#64748b;color:#fff;display:inline-flex;align-items:center;justify-content:center;font-weight:700;}

  /* FOOTER */
  .site-footer{background:#fff;margin-top:auto;border-top:1px solid var(--line);}
  .footer-main{padding:28px 0;}
  .footer-title{font-weight:700;margin-bottom:.6rem;}
  .footer-links a{margin:0 .75rem .4rem 0;color:#475569;text-decoration:none;}
  .footer-links a:hover{color:var(--brand);}
  .footer-meta{border-top:1px solid var(--line);background:#f8fafc;color:#64748b;}
  .footer-meta .container-xxl{display:flex;align-items:center;justify-content:space-between;padding:.65rem 0;}
  .footer-logo{height:34px;filter:drop-shadow(0 2px 6px rgba(2,6,23,.12));}
  .back-to-top{position:fixed;right:20px;bottom:20px;display:none;z-index:1050;border-radius:50%;box-shadow:var(--shadow-md);}
  </style>
</head>

<body class="d-flex flex-column">
  {% set logo_url = url_for('static', filename='images/epas-logo.png') %}
  <a class="skip-link" href="#main-content">Skip to content</a>

  <!-- Utility strip -->
  <div class="utilbar">
    <div class="container-xxl">
      <div class="d-flex align-items-center gap-3">
        <span class="status-dot"></span><span>System: <strong>Online</strong></span>
        <span class="vr d-none d-md-inline mx-2"></span><span class="d-none d-md-inline">v1.0</span>
      </div>
      <div class="util-links small">
        <a href="#">User Guide</a><a href="#">Workflow</a><a href="#">Model</a><a href="#">FAQ</a><a href="#">Report</a>
      </div>
    </div>
  </div>

  <!-- App bar -->
  <nav class="navbar navbar-expand-lg navbar-dark appbar">
    <div class="container-xxl">
      <a class="navbar-brand" href="{{ url_for('dashboard') }}">
        <img src="{{ logo_url }}" alt="EPAS logo" class="brand-logo"><span class="brand-text">EPAS</span>
      </a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#topNav"><span class="navbar-toggler-icon"></span></button>

      <div id="topNav" class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">{% block nav_items %}{% endblock %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"><i class="bi bi-speedometer2 me-1"></i> Dashboards</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{{ url_for('dashboard') }}">My Dashboard</a></li>
              {% if session.get('role')|lower in ['manager','hr','admin'] %}<li><a class="dropdown-item" href="{{ url_for('dashboard_manager') }}">Manager</a></li>{% endif %}
              {% if session.get('role')|lower in ['hr','admin'] %}<li><a class="dropdown-item" href="{{ url_for('dashboard_hr') }}">HR</a></li>{% endif %}
              {% if session.get('role')|lower == 'admin' %}<li><a class="dropdown-item" href="{{ url_for('dashboard_admin') }}">Admin</a></li>{% endif %}
            </ul>
          </li>
          {% if session.get('role')|lower in ['manager','hr'] %}
            <li class="nav-item"><a class="nav-link" href="{{ url_for('predict') }}">Predict</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('prediction_history') }}">History</a></li>
          {% endif %}
        </ul>

        <form class="d-flex nav-search ms-lg-3 my-2 my-lg-0" onsubmit="return false;">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input class="form-control" placeholder="Search…" readonly>
          </div>
        </form>

        <ul class="navbar-nav align-items-center ms-lg-3 gap-1">
          <!-- Notifications -->
          <li class="nav-item dropdown">
            <a class="nav-link position-relative" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-bell"></i>
              {% if notif_count and notif_count > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ notif_count }}</span>
              {% endif %}
            </a>
            <div class="dropdown-menu dropdown-menu-end p-0" style="width:320px;max-height:400px;overflow-y:auto;">
              <div class="list-group list-group-flush small">
                {% if notif_items %}
                  {% for n in notif_items %}
                    <div class="list-group-item d-flex align-items-start gap-2">
                      <i class="bi bi-activity text-primary"></i>
                      <div>{{ n.result or "New record" }}<div class="text-muted">{{ n.timestamp.strftime("%Y-%m-%d %H:%M") }}</div></div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="list-group-item text-center text-muted">No new notifications</div>
                {% endif %}
              </div>
            </div>
          </li>

          <!-- Theme toggle -->
          <li class="nav-item"><button id="themeToggle" class="btn btn-sm btn-ghost"><i class="bi bi-moon-stars" id="themeIcon"></i></button></li>

          <!-- User -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" data-bs-toggle="dropdown">
              <span class="avatar">{{ current_user.username[:2]|upper }}</span>
              <span class="d-none d-lg-inline">{{ current_user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal"><i class="bi bi-person me-2"></i> Profile</a></li>
              <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main id="main-content" class="container-xxl pb-5">{% block content %}{% endblock %}</main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-main">
      <div class="container-xxl row g-4">
        <div class="col-lg-4">
          <img src="{{ logo_url }}" alt="EPAS logo" class="footer-logo mb-2">
          <p class="small text-muted">Employee Attrition & Appraisal System helps forecast attrition and manage structured appraisals.</p>
          <p class="small mb-0">&copy; {{ current_year }} EAAS · All rights reserved.</p>
        </div>
        <div class="col-lg-4">
          <div class="footer-title">Resources</div>
          <div class="footer-links small"><a href="#">Guide</a><a href="#">Workflow</a><a href="#">Model</a><a href="#">FAQ</a></div>
          {% if session.get('role')|lower == 'hr' %}
            <div class="footer-title mt-2">HR Exports</div>
            <a class="btn btn-sm btn-outline-danger" href="{{ url_for('hr_export_pdf') }}">PDF</a>
            <a class="btn btn-sm btn-outline-success" href="{{ url_for('hr_export_excel') }}">Excel</a>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('hr_export_csv') }}">CSV</a>
          {% endif %}
        </div>
        <div class="col-lg-4">
          <div class="footer-title">Contact</div>
          <p class="small text-muted mb-1">Support: support@yourdomain.pg</p>
          <p class="small text-muted">Hours: Mon–Fri, 08:00–17:00</p>
          <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-secondary" href="#"><i class="bi bi-linkedin"></i></a>
            <a class="btn btn-sm btn-outline-secondary" href="#"><i class="bi bi-github"></i></a>
          </div>
        </div>
      </div>
    </div>
    <section class="footer-meta">
      <div class="container-xxl d-flex justify-content-between small">
        <div><a href="#">Privacy</a> · <a href="#">Terms</a> · <a href="#">Accessibility</a></div>
        <div>Made with ❤️ · EAAS</div>
      </div>
    </section>
  </footer>

  <a href="#" class="back-to-top btn btn-light"><i class="bi bi-arrow-up-short fs-3"></i></a>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Elevation on scroll + back-to-top
    const appbar=document.querySelector('.appbar'), backTop=document.querySelector('.back-to-top');
    window.addEventListener('scroll',()=>{const s=window.scrollY;appbar?.classList.toggle('elevated',s>6);backTop.style.display=s>200?'inline-flex':'none';});
    backTop?.addEventListener('click',e=>{e.preventDefault();window.scrollTo({top:0,behavior:'smooth'});});

    // Theme toggle
    (function(){const root=document.documentElement,key='eap-theme';const btn=document.getElementById('themeToggle'),icon=document.getElementById('themeIcon');
      function setTheme(t){root.setAttribute('data-bs-theme',t);localStorage.setItem(key,t);icon.className=(t==='dark')?'bi bi-sun':'bi bi-moon-stars';}
      setTheme(localStorage.getItem(key)||'light');btn?.addEventListener('click',()=>setTheme(root.getAttribute('data-bs-theme')==='dark'?'light':'dark'));})();
  </script>
  {% block scripts_extra %}{% endblock %}
</body>
</html>
