<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Employee Attrition Prediction</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-primary:#0d6efd;
      --hero-top:#0f4c5c;       /* top gradient */
      --hero-mid:#165f73;       /* middle gradient */
      --hero-btm:#0e3f53;       /* bottom gradient */
      --panel-border:#0e1720;
      --note-bg:#eef2f7;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    @font-face{
      font-family:"Billion Dreams";
      src:url("{{ url_for('static', filename='fonts/BillionDreams.ttf') }}") format("truetype");
      font-weight:400;
      font-style:normal;
      font-display:swap;
    }

    /* Base */
    html{ scroll-behavior:smooth; }
    body{ margin:0; background:#fff; color:#111;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; }
    img{ max-width:100%; height:auto; }

    /* ---------- Topbar (mobile-friendly) ---------- */
    .navbar{
      background:#fff; border:1px solid #dfe3ea; border-radius:10px;
      margin:16px 16px 0; padding:8px 12px; position:relative; isolation:isolate;
      --block-glow: rgba(13,110,253,.25);
      transition: box-shadow .25s ease, border-color .25s ease, transform .25s ease;
    }
    .navbar::before{ content:''; position:absolute; inset:-2px; border-radius:12px; z-index:-1;
      background: radial-gradient(160px 160px at var(--mx,50%) var(--my,0%), var(--block-glow), transparent 60%) no-repeat;
      opacity:0; filter:blur(10px); transition:opacity .25s ease; }
    .navbar:hover{ box-shadow:0 8px 24px rgba(0,0,0,.08), 0 0 0 1px var(--block-glow); border-color:transparent; }
    .navbar:hover::before{ opacity:1; }
    .navbar .container-fluid{ flex-wrap:wrap; gap:8px; }
    .navbar strong{ font-size:1rem; }

    /* For very small screens, make the action button full-width */
    @media (max-width: 576px){
      .navbar .ms-auto{ width:100%; display:flex; gap:8px; }
      .navbar .ms-auto .btn{ flex:1 1 auto; }
    }

    /* ---------- HERO (responsive) ---------- */
    .hero{
      position:relative; overflow:hidden; color:#fff;
      border:1px solid #0b1325; border-radius:14px; margin:12px 16px 16px;
      padding:calc(96px + var(--safe-top)) 16px 84px; min-height:360px; text-align:center;
      background:
        radial-gradient(900px 380px at 50% -30%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, var(--hero-top) 0%, var(--hero-mid) 55%, var(--hero-btm) 100%);
    }
    .hero::before{ content:""; position:absolute; inset:auto -10% 35% -10%; height:45%;
      background: linear-gradient(to right, rgba(255,255,255,.08), rgba(255,255,255,0) 55%),
                  linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.0));
      transform: skewY(-5deg); pointer-events:none; }
    .hero::after{ content:""; position:absolute; left:-5%; right:-5%; bottom:-1px; height:120px;
      background: radial-gradient(1200px 120px at 50% 0, rgba(255,255,255,.12), transparent 70%),
                  linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,0));
      filter: blur(2px); pointer-events:none; }

    /* Brand badge: scale with screen, keep tap-safe spacing */
    .brand-badge{ --size: clamp(96px, 22vw, 156px); width:var(--size); height:var(--size);
      position:absolute; left:50%; top:18px; transform:translateX(-50%);
      border-radius:22px; background:transparent; border:0;
      box-shadow: 0 10px 25px rgba(0,0,0,.25), 0 0 0 6px rgba(13,202,240,.08), 0 0 40px rgba(13,202,240,.30);
      display:grid; place-items:center; padding:0; isolation:isolate; }
    .brand-badge img{ width:100%; height:100%; object-fit:contain; border-radius:22px; display:block; }
    .brand-badge.no-img::after{ content:"LOGO"; color:#fff; opacity:.75; font-weight:700; letter-spacing:.06em; }

    .hero .kicker{ font-family:"Billion Dreams","Pacifico",cursive; font-size:clamp(18px,2.2vw,26px); line-height:1.15; margin:calc(34px + var(--size)) 0 8px; }
    .hero .title{ font-family:"Poppins",sans-serif; text-transform:uppercase; letter-spacing:.02em; font-weight:700;
      font-size:clamp(20px,4.2vw,40px); margin:0 auto 10px; max-width:1100px; padding:0; background:transparent; box-shadow:none; }
    .hero .tag{ font-family:"Pristina","Billion Dreams","Pacifico",cursive; font-size:clamp(14px,1.8vw,18px); line-height:1.35; opacity:.95; margin-top:8px; }

    /* Compact hero on very small phones */
    @media (max-width: 400px){
      .hero{ padding-top:calc(72px + var(--safe-top)); min-height:300px; }
      .hero .kicker{ margin-top:calc(24px + var(--size)); }
    }

    /* ---------- Panels / blocks ---------- */
    .panels-wrap{ margin:0 16px 8px; }
    .panel-white{ background:#fff; border:2px solid var(--panel-border); border-radius:8px; min-height:160px; padding:14px 16px; }
    .panel-white,
    .instructions-block{ position:relative; isolation:isolate; --block-glow: rgba(13,110,253,.22);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background-color .25s ease; }
    .panel-white::before,
    .instructions-block::before{ content:''; position:absolute; inset:-2px; border-radius:10px; z-index:-1;
      background: radial-gradient(180px 180px at var(--mx,50%) var(--my,0%), var(--block-glow), transparent 62%) no-repeat;
      opacity:0; filter:blur(12px); transition:opacity .25s ease; }
    .panel-white:hover,
    .instructions-block:hover{ transform: translateY(-4px); border-color: transparent;
      box-shadow: 0 14px 32px rgba(0,0,0,.12), 0 0 0 1px var(--block-glow), 0 0 34px var(--block-glow); }
    .panel-white:hover::before,
    .instructions-block:hover::before{ opacity:1; }

    .two-panels{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:1rem; }
    @media (max-width: 992px){ .two-panels{ grid-template-columns:1fr; } }
    .two-panels > .panel-cell{ display:flex; }
    .two-panels > .panel-cell .panel-white{ display:flex; flex-direction:column; height:100%; }

    .panel-heading{ font-family:"Poppins",sans-serif; text-transform:uppercase; font-weight:700; font-size:clamp(14px,2vw,18px); text-align:center; margin-bottom:8px; }
    .panel-white p{ color:#344054; margin-bottom:.6rem; line-height:1.6; }
    .panel-white ul{ margin:.25rem 0 .5rem 1.25rem; }
    .panel-white li{ color:#344054; margin:.25rem 0; }

    /* ---------- Instructions + Portals (mobile grid) ---------- */
    .instructions-block{ margin:14px 16px 8px; background:var(--note-bg); border:1px solid #cfd6df; border-radius:10px; padding:12px 12px 0; --block-glow: rgba(13,202,240,.28); }
    .instructions-block .leadline{ font-weight:600; }
    .instructions-block ol{ margin:6px 0 10px 20px; color:#334155; font-size:14px; }

    .portal-grid{ display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:12px; padding:12px 6px 16px; }
    @media (max-width: 992px){ .portal-grid{ grid-template-columns:repeat(2,1fr);} }
    @media (max-width: 576px){ .portal-grid{ grid-template-columns:1fr;} }
    .portal-card{ background:#fff; border:1px solid #e6e9ee; border-radius:14px; padding:18px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,.04); }
    .portal-icon{ display:flex; align-items:center; justify-content:center; width:64px; height:64px; border-radius:50%; margin:0 auto 10px; font-size:28px; }
    .portal-card p{ margin:0 0 10px; font-size:.95rem; color:#475569; }

    footer{ border-top:1px solid #e7eaf0; margin:10px 16px; padding:8px 0 calc(16px + var(--safe-bottom)); color:#6b7280; text-align:center; }

    /* ---------- Portal cards fancy hover ---------- */
    .portal-card{ position: relative; isolation: isolate; transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background-color .25s ease; cursor: pointer; --glow: rgba(13,110,253,.55); }
    .portal-card:has(.btn-success){ --glow: rgba(25,135,84,.55); }
    .portal-card:has(.btn-info){    --glow: rgba(13,202,240,.55); }
    .portal-card:has(.btn-dark){    --glow: rgba(33,37,41,.70); }
    @supports not (selector(:has(*))){
      .portal-grid .portal-card:nth-child(2){ --glow: rgba(25,135,84,.55); }
      .portal-grid .portal-card:nth-child(3){ --glow: rgba(13,202,240,.55); }
      .portal-grid .portal-card:nth-child(4){ --glow: rgba(33,37,41,.70); }
    }
    .portal-card::before{ content:''; position:absolute; inset:-2px; border-radius:14px; background: radial-gradient(140px 140px at var(--mx,50%) var(--my,0%), var(--glow), transparent 60%) no-repeat; opacity:0; filter: blur(8px); transition: opacity .25s ease; z-index:-1; }
    .portal-card:hover{ transform: translateY(-6px) scale(1.01); border-color: transparent; box-shadow: 0 12px 30px rgba(0,0,0,.14), 0 0 0 1.5px var(--glow), 0 0 36px var(--glow); }
    .portal-card:hover::before{ opacity:1; }
    .portal-icon{ position: relative; transition: transform .25s ease, box-shadow .25s ease; }
    .portal-card:hover .portal-icon{ transform: translateY(-2px) scale(1.06); }
    .portal-icon::after{ content:''; position:absolute; inset:-8px; border-radius:50%; box-shadow: 0 0 0 0 var(--glow), inset 0 0 0 rgba(255,255,255,0); opacity:0; transition: all .3s ease; }
    .portal-card:hover .portal-icon::after{ opacity:.95; box-shadow: 0 0 24px 6px var(--glow), inset 0 0 18px rgba(255,255,255,.45); }
    .portal-card h6{ transition: color .2s ease; }
    .portal-card:hover h6{ color:#0b1325; }
    .portal-card:focus-visible{ outline:none; transform: translateY(-6px); box-shadow: 0 0 0 3px var(--glow), 0 12px 30px rgba(0,0,0,.16); }
    .portal-card .ripple{ position:absolute; border-radius:50%; pointer-events:none; transform: scale(0); background: var(--glow); opacity:.25; animation: portal-ripple .6s ease-out forwards; }
    @keyframes portal-ripple{ to{ transform: scale(12); opacity:0; } }

    /* ---------- Universal button glow + ripple ---------- */
    .btn{ position:relative; overflow:hidden; transition: transform .18s ease, box-shadow .18s ease; --btn-glow: rgba(13,110,253,.55); }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,.10), 0 0 0 1px var(--btn-glow), 0 0 22px var(--btn-glow); }
    .btn:active{ transform: translateY(0); box-shadow:none; }
    .btn-primary, .btn-outline-primary{ --btn-glow: rgba(13,110,253,.55); }
    .btn-success, .btn-outline-success{ --btn-glow: rgba(25,135,84,.55); }
    .btn-info, .btn-outline-info{ --btn-glow: rgba(13,202,240,.55); }
    .btn-danger, .btn-outline-danger{ --btn-glow: rgba(220,53,69,.55); }
    .btn-warning, .btn-outline-warning{ --btn-glow: rgba(255,193,7,.55); }
    .btn-secondary, .btn-outline-secondary{ --btn-glow: rgba(108,117,125,.55); }
    .btn-dark, .btn-outline-dark{ --btn-glow: rgba(33,37,41,.70); }
    .btn-light, .btn-outline-light{ --btn-glow: rgba(200,200,200,.55); }
    .btn .ripple{ position:absolute; border-radius:50%; pointer-events:none; transform:scale(0); background: var(--btn-glow); opacity:.28; animation: btn-ripple .55s ease-out forwards; }
    @keyframes btn-ripple{ to{ transform:scale(10); opacity:0; } }

    /* Motion preferences */
    @media (prefers-reduced-motion: reduce){
      .portal-card, .portal-card::before, .portal-icon, .portal-icon::after,
      .btn, .navbar, .panel-white, .instructions-block, .hero, .brand-badge{ transition:none !important; }
      .portal-card:hover, .navbar:hover{ transform:none !important; box-shadow:none !important; }
    }

    /* === Spacing + title banner removal (keeps logo fully visible) === */
    .hero{ padding-top: 180px; }
    .hero .title{ background: transparent !important; box-shadow: none !important; padding: 0; }
    .hero .tag{ margin-top: 10px; }

    /* Utility: larger tap targets on mobile */
    @media (max-width: 576px){
      .btn{ padding:.85rem 1rem; font-size:1rem; }
      .portal-card h6{ font-size:1rem; }
      .panel-white{ padding:12px; }
      .instructions-block ol{ font-size:.95rem; }
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <nav class="navbar">
    <div class="container-fluid p-0 align-items-center">
      <div class="d-flex align-items-center gap-2 flex-grow-1">
        <i class="bi bi-graph-up"></i>
        <strong>Employee Attrition Prediction</strong>
      </div>
      <div class="ms-auto d-flex align-items-center gap-2">
        <a href="{{ url_for('recover') }}" class="small link-secondary text-decoration-none">Forgot Password</a>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#signupModal">
          <i class="bi bi-person-plus"></i> Create Account
        </button>
      </div>
    </div>
  </nav>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container mt-2">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- HERO -->
  <header class="hero">
    <div class="brand-badge" id="brandBadge">
      <img id="brandLogo" src="{{ url_for('static', filename='images/eapas-logo.png') }}" alt="EAPAS Logo"
           onerror="this.style.display='none'; this.parentElement.classList.add('no-img');">
    </div>

    <div class="kicker">Welcome To</div>
    <h1 class="title">Employee Attrition Predictor &amp; Appraisal System</h1>
    <div class="tag">Role-based HR platform that blends performance management with machine-learning attrition insights</div>
  </header>

  <!-- Two Panels -->
  <section class="panels-wrap">
    <div class="two-panels">
      <div class="panel-cell">
        <div class="panel-white">
          <div class="panel-heading">What this system is</div>
          <p>
            This system uses machine learning to estimate each employee’s attrition risk (how likely they are to stay or leave the organization).
            Alongside that, it also runs the performance appraisal process (submissions, reviews, approvals). When HR completes an appraisal and the HR Committee (HRC) makes its final decision (e.g., promotion, performance rating, improvement plan), that outcome is fed back into the Machine Learning model as one of the inputs. The model combines this HRC decision with other employee details such as tenure, department, overtime, past ratings, attendance, salary band, etc. to produce an updated attrition level (low/high or a probability).
          </p>
        </div>
      </div>
      <div class="panel-cell">
        <div class="panel-white">
          <div class="panel-heading">What it can do</div>
          <ul class="mb-0">
            <li>Predict attrition risk with confidence &amp; top drivers; show tailored recommendations.</li>
            <li>Run performance cycles with submissions, reviews, returns, and approvals.</li>
            <li>Role-specific dashboards, HR trend analytics (department, tenure, overtime).</li>
            <li>Manage users/roles/passwords; export datasets to CSV/Excel.</li>
            <li>Train or replace ML models in-app; encoder/columns kept in sync.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Instructions + Portals -->
  <section class="instructions-block">
    <div class="small leadline"><i class="bi bi-hand-index-thumb me-1"></i>Choose your portal, then sign in:</div>
    <ol>
      <li>Click the card that matches your role (Employee, Manager, HR, or Admin).</li>
      <li>In the modal, enter <em>Username or Email</em> and <em>Password</em>. The system verifies the role automatically.</li>
      <li>New here? Select <strong>Create Account</strong>. Forgot? Use <strong>Forgot Password</strong>.</li>
    </ol>

    <div class="portal-grid">
      <div class="portal-card">
        <div class="portal-icon bg-primary-subtle text-primary"><i class="bi bi-person-badge"></i></div>
        <h6>Employee Portal</h6>
        <p>Access your dashboard, view appraisal history, and submit self-assessments.</p>
        <button type="button" class="btn btn-primary w-100" data-role="EMPLOYEE" data-bs-toggle="modal" data-bs-target="#loginModal">Continue as Employee</button>
      </div>

      <div class="portal-card">
        <div class="portal-icon bg-success-subtle text-success"><i class="bi bi-people"></i></div>
        <h6>Manager Portal</h6>
        <p>Review team appraisals, submit ratings, and track performance trends.</p>
        <button type="button" class="btn btn-success w-100" data-role="MANAGER" data-bs-toggle="modal" data-bs-target="#loginModal">Continue as Manager</button>
      </div>

      <div class="portal-card">
        <div class="portal-icon bg-info-subtle text-info"><i class="bi bi-person-lines-fill"></i></div>
        <h6>HR Portal</h6>
        <p>Generate reports, monitor risk signals, and manage appraisal cycles.</p>
        <button type="button" class="btn btn-info w-100" data-role="HR" data-bs-toggle="modal" data-bs-target="#loginModal">Continue as HR</button>
      </div>

      <div class="portal-card">
        <div class="portal-icon bg-dark text-white"><i class="bi bi-gear"></i></div>
        <h6>Admin Portal</h6>
        <p>Configure roles, criteria, and system settings for all departments.</p>
        <button type="button" class="btn btn-dark w-100" data-role="ADMIN" data-bs-toggle="modal" data-bs-target="#loginModal">Continue as Admin</button>
      </div>
    </div>
  </section>

  <!-- Login MODAL (fullscreen on small screens) -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
      <div class="modal-content">
        <div id="loginModalHeader" class="modal-header text-white bg-primary">
          <h5 class="modal-title">
            <span id="loginRoleIcon" class="me-2"></span>
            <span id="loginRoleTitle">Sign in</span>
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="POST" action="{{ url_for('login') }}">
            <input type="hidden" id="expected_role" name="expected_role" value="EMPLOYEE">
            <div class="mb-3">
              <label class="form-label">Username or Email</label>
              <input type="text" name="identifier" class="form-control" required autocomplete="username" inputmode="email">
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" name="password" class="form-control" required autocomplete="current-password">
            </div>
            <button id="loginSubmitBtn" type="submit" class="btn btn-primary w-100">Login</button>
          </form>
          <p class="mt-3 text-center">
            <a href="{{ url_for('recover') }}" class="link-secondary">Forgot Password?</a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- SIGN-UP MODAL (fullscreen on small) -->
  <div class="modal fade" id="signupModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen-sm-down">
      <div class="modal-content">
        <div class="modal-header bg-secondary text-white">
          <h5 class="modal-title"><i class="bi bi-person-plus me-2"></i>Create your account</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="needs-validation" method="POST" action="{{ url_for('register') }}" novalidate>
            {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Username</label>
                <input type="text" name="username" class="form-control" required autocomplete="username">
                <div class="invalid-feedback">Username is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" required autocomplete="email" inputmode="email">
                <div class="invalid-feedback">Valid email is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Password</label>
                <div class="input-group">
                  <input id="pw1" type="password" name="password" class="form-control" required autocomplete="new-password" minlength="12">
                  <button id="togglePw1" class="btn btn-outline-secondary" type="button" tabindex="-1"><i class="bi bi-eye"></i></button>
                </div>
                <div class="progress mt-2" style="height:6px;"><div id="pwStrength" class="progress-bar" style="width:0%"></div></div>
                <small id="pwHint" class="text-muted">Use 12+ chars with upper, lower, number, symbol.</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">Confirm Password</label>
                <div class="input-group">
                  <input id="pw2" name="confirm_password" type="password" class="form-control" required autocomplete="new-password" minlength="12">
                  <button id="togglePw2" class="btn btn-outline-secondary" type="button" tabindex="-1"><i class="bi bi-eye"></i></button>
                </div>
                <div class="invalid-feedback">Passwords must match.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Role</label>
                <select id="signupRoleSelect" name="role" class="form-select" required>
                  <option value="" disabled selected>Choose…</option>
                  <option value="EMPLOYEE">Employee</option>
                  <option value="MANAGER">Manager</option>
                  <option value="HR">HR</option>
                  <option value="ADMIN">Admin</option>
                </select>
                <div class="invalid-feedback">Please pick a role.</div>
              </div>
            </div>

            <div id="employeeFields" class="mt-3 d-none">
              <div class="border rounded p-3">
                <div class="row g-3">
                  <div class="col-md-6"><label class="form-label">Full Name</label><input type="text" name="name" class="form-control"></div>
                  <div class="col-md-6"><label class="form-label">Employee ID</label><input type="text" name="employee_id" class="form-control"></div>
                  <div class="col-md-6"><label class="form-label">Department</label><input type="text" name="department" class="form-control"></div>
                  <div class="col-md-6"><label class="form-label">Job Title</label><input type="text" name="title" class="form-control"></div>
                  <div class="col-md-6"><label class="form-label">Manager Name</label><input type="text" name="manager_name" class="form-control"></div>
                  <div class="col-md-6"><label class="form-label">Phone</label><input type="text" name="phone" class="form-control" inputmode="tel"></div>
                  <div class="col-12"><label class="form-label">Location</label><input type="text" name="location" class="form-control" placeholder="City, Country"></div>
                </div>
              </div>
            </div>

            <div class="form-check mt-3">
              <input id="agree" class="form-check-input" type="checkbox" required>
              <label class="form-check-label" for="agree">I agree to the Terms & Privacy Policy</label>
              <div class="invalid-feedback">You must agree before submitting.</div>
            </div>

            <div class="d-flex gap-2 mt-3">
              <button type="submit" class="btn btn-primary w-100">Create Account</button>
              <button type="button" class="btn btn-outline-secondary w-100" data-bs-dismiss="modal">Cancel</button>
            </div>

            <div id="demoFillers" class="mt-3 d-flex gap-2 flex-wrap">
              <button type="button" class="btn btn-sm btn-outline-primary" data-fill="employee">Demo: Employee</button>
              <button type="button" class="btn btn-sm btn-outline-success" data-fill="manager">Demo: Manager</button>
              <button type="button" class="btn btn-sm btn-outline-info" data-fill="hr">Demo: HR</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <small>&copy; 2025 Employee Attrition Prediction. All rights reserved.</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Role presets for login modal
    const rolePresets = {
      EMPLOYEE:{ title:"Employee Login", header:"bg-primary", btn:"btn-primary", icon:'<i class="bi bi-person-badge"></i>' },
      MANAGER: { title:"Manager Login",  header:"bg-success", btn:"btn-success", icon:'<i class="bi bi-people"></i>' },
      HR:      { title:"HR Login",       header:"bg-info",    btn:"btn-info",    icon:'<i class="bi bi-person-lines-fill"></i>' },
      ADMIN:   { title:"Admin Login",    header:"bg-dark",    btn:"btn-dark",    icon:'<i class="bi bi-gear"></i>' },
    };

    function applyRole(role){
      const preset = rolePresets[role] || rolePresets.EMPLOYEE;
      document.getElementById('expected_role').value = role;
      document.getElementById('loginRoleTitle').textContent = preset.title;
      document.getElementById('loginRoleIcon').innerHTML = preset.icon;
      const header = document.getElementById('loginModalHeader');
      header.className = 'modal-header text-white ' + preset.header;
      const btn = document.getElementById('loginSubmitBtn');
      btn.className = 'btn w-100 ' + preset.btn;
      sessionStorage.setItem('lastRole', role);
    }

    document.querySelectorAll('[data-role]').forEach(btn => {
      btn.addEventListener('click', () => applyRole(btn.getAttribute('data-role') || 'EMPLOYEE'));
    });

    document.getElementById('loginModal')?.addEventListener('show.bs.modal', (ev) => {
      const r = ev.relatedTarget?.getAttribute?.('data-role')
             || (new URLSearchParams(location.search).get('open') || '').split('_')[1]?.toUpperCase()
             || sessionStorage.getItem('lastRole')
             || 'EMPLOYEE';
      applyRole(r);
    });

    // Signup helpers
    (function(){
      const form = document.querySelector('#signupModal form.needs-validation');
      const pw1 = document.getElementById('pw1'), pw2 = document.getElementById('pw2');
      const bar = document.getElementById('pwStrength'), hint = document.getElementById('pwHint');
      function togglePw(input, btnId){
        const btn = document.getElementById(btnId), eye = btn.querySelector('i');
        input.type = (input.type === 'password') ? 'text' : 'password';
        eye.className = (input.type === 'password') ? 'bi bi-eye' : 'bi bi-eye-slash';
      }
      document.getElementById('togglePw1')?.addEventListener('click', ()=>togglePw(pw1,'togglePw1'));
      document.getElementById('togglePw2')?.addEventListener('click', ()=>togglePw(pw2,'togglePw2'));
      function updateStrength(){
        const v = pw1?.value || '';
        const rules = [/[a-z]/,/[A-Z]/,/\d/,/[^A-Za-z0-9]/,/.{12,}/].map(r=>r.test(v));
        const score = rules.filter(Boolean).length, pct = (score/5)*100;
        bar.style.width = pct + '%'; bar.className = 'progress-bar';
        if (score <= 2) { bar.classList.add('bg-danger'); hint.textContent='Weak'; }
        else if (score === 3) { bar.classList.add('bg-warning'); hint.textContent='Fair'; }
        else if (score === 4) { bar.classList.add('bg-info'); hint.textContent='Good'; }
        else { bar.classList.add('bg-success'); hint.textContent='Strong'; }
      }
      pw1?.addEventListener('input', updateStrength);
      function pwMatch(){ const ok = (pw1.value === pw2.value); pw2.setCustomValidity(ok?'':'Passwords do not match'); return ok; }
      pw2?.addEventListener('input', pwMatch);
      const roleSelect = document.getElementById('signupRoleSelect');
      const empWrap = document.getElementById('employeeFields');
      const empNames = ['name','employee_id','department','title','manager_name','phone','location'];
      function updateEmployeeFields(){
        const isEmp = roleSelect?.value === 'EMPLOYEE';
        empWrap?.classList.toggle('d-none', !isEmp);
        empNames.forEach(n=>{
          const el = document.querySelector(`#signupModal [name="${n}"]`);
          if (!el) return; if (isEmp) el.setAttribute('required',''); else el.removeAttribute('required');
        });
      }
      roleSelect?.addEventListener('change', updateEmployeeFields);
      form?.addEventListener('submit', (ev)=>{
        if (!form.checkValidity() || !pwMatch()) { ev.preventDefault(); ev.stopPropagation(); }
        form.classList.add('was-validated');
      });
    })();

    // Demo autofill
    (function(){
      const samples = {
        employee: { username:"evelyn.park", email:"evelyn.park@acme.com", password:"EPark#2025!", role:"EMPLOYEE", agree:true,
          details:{ name:"Evelyn Park", employee_id:"E10234", department:"Sales", title:"Sales Associate", manager_name:"Jordan Reed", phone:"512-555-0163", location:"Austin, TX" } },
        manager:  { username:"marco.lee",  email:"marco.lee@acme.com",  password:"MLee#2025!",  role:"MANAGER", agree:true },
        hr:       { username:"nina.patel", email:"nina.patel@acme.com", password:"NPatel#2025!", role:"HR", agree:true }
      };
      const $form=document.querySelector('#signupModal form.needs-validation'); if(!$form) return;
      const $user=$form.querySelector('[name="username"]'), $email=$form.querySelector('[name="email"]');
      const $pw1=$form.querySelector('#pw1'), $pw2=$form.querySelector('#pw2');
      const $role=$form.querySelector('#signupRoleSelect'), $agree=$form.querySelector('#agree');
      function setVal(el,v){ if(el){ el.value=v; el.dispatchEvent(new Event('input',{bubbles:true})); } }
      function setChange(el){ if(el){ el.dispatchEvent(new Event('change',{bubbles:true})); } }
      function fillDetails(d){ if(!d)return; ['name','employee_id','department','title','manager_name','phone','location'].forEach(n=>{ const el=$form.querySelector(`[name="${n}"]`); if(el && d[n]!==undefined) setVal(el,d[n]); }); }
      function clearDetails(){ ['name','employee_id','department','title','manager_name','phone','location'].forEach(n=>{ const el=$form.querySelector(`[name="${n}"]`); if(el) el.value=''; }); }
      function fillSample(k){
        const d=samples[k]; if(!d) return; $form.classList.remove('was-validated');
        setVal($user,d.username); setVal($email,d.email); setVal($pw1,d.password); setVal($pw2,d.password);
        if($agree){ $agree.checked=!!d.agree; setChange($agree); }
        if($role){ $role.value=d.role; setChange($role); }
        if(d.role==='EMPLOYEE') fillDetails(d.details); else clearDetails();
        $pw1?.dispatchEvent(new Event('input',{bubbles:true}));
      }
      document.querySelectorAll('#demoFillers [data-fill]').forEach(btn=>btn.addEventListener('click',()=>fillSample(btn.dataset.fill)));
    })();

    // Auto-open via ?open=...
    (function () {
      const params = new URLSearchParams(location.search);
      const open = params.get('open');
      if (!open) return;

      if (sessionStorage.getItem('openParamConsumed') === '1') {
        history.replaceState(null, '', location.pathname + (location.hash || ''));
        return;
      }
      sessionStorage.setItem('openParamConsumed', '1');

      const modal = (id) => new bootstrap.Modal(document.getElementById(id));
      if (open === 'signup' || open === 'register') {
        modal('signupModal').show();
      } else if (open.startsWith('login')) {
        const parts = open.split('_');
        const role = (parts[1] || '').toUpperCase();
        if (role) sessionStorage.setItem('lastRole', role);
        modal('loginModal').show();
      }
      history.replaceState(null, '', location.pathname + (location.hash || ''));
    })();

    // Interactive glow for blocks & buttons (and navbar)
    (function(){
      const blocks = document.querySelectorAll('.navbar, .panel-white, .instructions-block, .portal-grid .portal-card');
      blocks.forEach(el=>{
        el.addEventListener('pointermove', (e)=>{
          const r = el.getBoundingClientRect();
          el.style.setProperty('--mx', (e.clientX - r.left) + 'px');
          el.style.setProperty('--my', (e.clientY - r.top) + 'px');
        });
      });

      // Make portal card entire area clickable, with ripple
      document.querySelectorAll('.portal-grid .portal-card').forEach(card=>{
        const cta = card.querySelector('button[data-bs-toggle="modal"]');
        card.tabIndex = 0;
        card.addEventListener('click', (e)=>{ if (!e.target.closest('button')) cta?.click(); });
        card.addEventListener('keydown', (e)=>{ if (e.key==='Enter'||e.key===' ') { e.preventDefault(); cta?.click(); }});
        card.addEventListener('pointerdown', (e)=>{
          const r = card.getBoundingClientRect();
          const s = document.createElement('span');
          const size = Math.max(r.width, r.height);
          s.className = 'ripple';
          s.style.width = s.style.height = size + 'px';
          s.style.left = (e.clientX - r.left - size/2) + 'px';
          s.style.top  = (e.clientY - r.top  - size/2) + 'px';
          card.appendChild(s);
          setTimeout(()=>s.remove(), 700);
        });
      });

      // Button ripple
      document.addEventListener('pointerdown', (e)=>{
        const btn = e.target.closest('.btn');
        if(!btn) return;
        const r = btn.getBoundingClientRect();
        const s = document.createElement('span');
        const size = Math.max(r.width, r.height);
        s.className = 'ripple';
        s.style.width = s.style.height = size + 'px';
        s.style.left = (e.clientX - r.left - size/2) + 'px';
        s.style.top  = (e.clientY - r.top  - size/2) + 'px';
        btn.appendChild(s);
        setTimeout(()=>s.remove(), 600);
      });
    })();
  </script>
</body>
</html>
